## Domain 2.0 Vulnerability Management

Vulnerability management programs seek to identify, prioritize, and remediate these vulns before an attacker exploits them and comps one of the CIA of an information asset. Organized approach to scanning assets for vulns and using a defined workflow to remediate those vulns and preform contiued assesments to provide insight into the current state of the networks cybersecurity.

While a vuln mgmt plan is being developed, you need to first identify any internal or external requirements for vuln scanning. These may be regulatory environments where the org operates and/or internal policy-driven requirements.

 <details>
 <summary>Regulatory Environment</summary>
 <br>
 
 Laws and regulations that govern how to store, process, and transmit info. Like handeling sensitive personal info or info belonging to gov agencies. 
HIPPA(Health Insurance Portability and Accountability Act, how to handle health info)  and the GLBA(Gramm-Leach-Bliley Act, how financial inst. may handle cust financial records) do not specifically address the implementation of a vuln mgmt program, they dont state that vuln scanning is required.

The PCI(Payment Card Industry Data Security Standard) and FISMA(Federal Info Security Mgmt Act) do mandate the implementation of a vuln mgmt program.

These two cover org involved in processing retail tansactions and operating gov systems, this only covers a fraction of the enterprise. It is widely agreed that vuln mgmt is a critical component of any info security program, for this many org mandate vuln scanning in corporate policy , even if not imposed by regulatory requirements.

<details>
  <summary>PCI DSS(Payment Card Industry Data Security Standard)</summary>
  <br>
  - This is NOT a LAW, is maintained by the PCI SSC(Payment Card Industry Sec Standards Council) funded by industry to maintain req
  - Those subject to PCI DSS are by contract not law
  Specific security controls for merchs who that handle CC transactions and providers that assists with them. Includes arguably the most specific req for vuln scanning. 
  
  ## Included details for vuln scans
    - ORG must run internal and external scan (req 11.2)
    - run scans at least quarterly and after significant changes to network (new FW rule, system upgrade, new component (req 11.2)
    - Internal scans ran by qualified personal (req 11.2.1)
    - Org must remediate and high risk vuln and repeat scan to confirm they are resolved until a clean scan report (req 11.2.1)
    - External scan done by Approved Scanning Vendor (ASV) auth by PCI SSC (req 11.2.2) (many org may conduct their own scans first to assure of a passing grade)
  </details>

<details>
  <summary>FISMA(Federal Information Security Management)</summary>
  <br>
  Security standards for gov agencies & Org on behalf of gov. The specific standards depend on if the gov designates the system as low, moderate, or high impact according to chart below. Furhter guidance in Federal Info Process Standards (FIPS) 199.
    
   [![Capture.png](https://i.postimg.cc/DfsWPfr9/Capture.png)](https://postimg.cc/WtNb2vf8)
  
 
  All federal info systems regardless of impact must meet the basic req for vuln scanning found in NIST Special Publication 800-53: Security and Privacy Controls for Federal Info Systems and Orgs. These req that each org subject to FISMA:
  
  a. Scans for vulns in the info system and hosted apps when new vulns potentually affecting the system/app are reported
  
  b. Employ vuln scan tool and techniques that make it easier to have the systems tools work together and automate vuln mgmt process by using standards for:
    1. Enumerating paltforms, software flaws, & improper configs
    2. formatting checklist & test proc
    3. Measuring vuln impact
    
  c. Analyze vuln scan reportand results from sec control assessments.
 
  d. Remediate legit vuln in accordance wih an org assessment of risk
  
  e. Shares info obtained from the vuln scan process and sec control assessment to help eliminate similar vulns in other info systems (i.e systemic weakness or deficiencies)
  
  */ These req est a baseline for all federal info sys. /* 
  
  NIST 800-53 then desc 8 control enhancements that may be req depending on the situation.
  
   1. Org uses vuln scan tools that include the ability to readily update the info systems vulns to be scanned
   2. Org updates vulns scanned prior to a new scan and/or when new vulns are identified and reported.
   3. Org employs vuln scanning procs that can identify the breadth and depth of coverage(i.e info system components scanned and vulns checked)
   4. Org determines what info about info systems is discoverable b adversaries and then takes org defined corrective actions.
   5. Info system implements priv access auth to info system components for selected vuln scanning activities.
   6. Org employs automated mechanisms to compare the results of vuln scans over time to determine trends in info system vulns.
   8. Org reviews historic audit logs to determine if an identified vuln has been previously exploited.
   10. Org correlates the output from vuln scanning tools to determine the resence of multi-vuln/ multi-hop attack vectors.
   
   */ req 7 & 9 were control enhancements that were once included but since have been with drawn. /*
   
   If federal agency determines an info system falls under the moderate impact, it must implement 1,2, and 5 at a minimum
   If it falls under high impact then 1,2,4, and 5.
  </details>
</details>


An organization has decided to conduct a vulnerability scan:
 - must check if they fall under any regulatory requirments
 - next step is to identify targets covered in the scan
 - Scan targets should be selected based on discovery scans and org criteria 
 - some choose all where as some choose based on the following questions
   - data classicfication of data being stored, processed or stored?
   - Is there system exposed to the internet/public/semi-public networks?
   - what service is offered on the system?
   - Is the system prod, test, or dev?

Orgs may use automated ways to identify systems that may be coverd in a scan. May use tools to search the network for connected systems wheather previously known or not. They then can build an asset inventory. QualysGuard offers such a function called asset map. Then adding info the the assets in the map. Asset info and critical info helps guide the types of scans and there freq as well as priority admins shoud place on the vulns detected in the scan. Orgs may decide to automate vuln scans and should also have automated alerting when vulns are detected. The freq of these scans can be influenced by factors such as */ risk appetite /* , willingness to tolerate risk, being how freq to run scans to minimize time in between when a vuln is discovered and detected by scan. Regulatory req, corporate policy. Technical constraints, scanning system may only be able to preform a certain amount of scans in a day, need to adjust to preform all scans properly. Business contraints may limit resource intensive scans from being conducted during periods of high buisness activty. Licensing Limitations may curtail the bandwidth or number of scans that can be conducted simultaneously.

Must balance each of these when planning. Wise to start small and slowly expan the scope & freq of the scan over time to avoid overwhelming the scanning infrastructure or enterprise systems.

<details>
 <summary>Configuring and Executing Vulnerability Scans</summary>
 <br>
 After determining the basic req for their vuln scan mgmt program, then you must config the vuln mgmt tools to preform the scans according to the req-based scan specs. This includes scopes for the scans, configs to meet the orgs reqs, and maintain the currency of the vuln scan tool. 
 
 ### Scope
 
   Scope describes the extent of the scan like what systems and networks will be included, what technical measures will be used to test whether the systems are present on the network, and what tests will be preformed against systems discovered by a vuln scan. Admins should answer these along with technical staff to insure this is appropriate and unlikely to cause disruption to business, then move onto configuring the vuln mgmt tool. Scoping for regulations can be reduced to a manageable size by scanning for say PCI DSS for the whole enterprise can be tough, so properly segmenting the network and only scanning devices that handle that data can make it more manageable and ensure it has been done properly, reducing the controls in place and scope to focus on systems that actually engage in card processing. This will reduce cost of scanning and remediation workload. 
   
  ### Configuring scans
  
   Vuln mgmt solutions have plently of parameters: scheduling scans & reports, types of checks, credential scans, install scannign agents on servers, and have network presepectve scans. Pay careful attention to settings related to scan sev lvls, these will determine the types of checks the scanner will preform and should be customized to keep inline with objectives and not disrupt target env. Templates help efficiancy. Each plug-in preforms a check for a specific vuln, these often are grouped into a family based on the OS, app, or involved device. You can dissable unnecessary plug-ins to improve speed of the scan, this may also reduce FPs. Example, Org may not use Amazon Linux OS, so you disable all plug-ins related to checking that OS. Some plug-ins may cause damage or disrupt content on a system, this can be bad on a prod device, so having a test env is where these plug-ins are preformed. If something using these plug-ins is detected in the test, then can be corrected in prod. 
   
   Remote vuln scans may report false or skewed info due to firewalls, IDS/IPS, or other devices in between. To help with this you can supplement these remote scanners with info on the target. One way is providing the scanner with creds to the target to grab config info and detecting vulns that way improving over a noncred scan (Scanner will only retreive info and does not make any changes, but enforce principle of least priv by providing the scanner with read only to reduce the likleyhood of incident related to the scanners access). Or Installing agents on the target or an "inside out" vuln scan and report back to the management platform for analysis. Test agent based carefully as it may hinder preformance depending on what the system does. 
  
 ### Scan perspective
 
   Vuln mgmt tools provide the ability to conduct scans from a variety of scan perspectives such as External(from internet), Internal (may be ran from Corp network), and Inside the DC itself to show vulns that might have been blocked by security controls on the network. 
   
   Vuln mgmt solutions should have regualr updates and maintinance. This may be new plug-ins(updates can be scheduled) or updates to the vuln software itself, as it can contain vulnerabilites as well. 
   
   
  ### SCAP
  
   Security Content Automation Protocol is an effort by the security community led by NIST to create a standard way communicate security-related info. Important to the automation of interactions between security components. SCAP includes:
   
   - CCE Common Config Enumeration (nomenclature for discussing config issues)
   
   - CPE Common Platform Enumeration (nomenclature for desc product names and versions)
   
   - CVE Common Vuln and Exposures (nonmenclature for desc security related software flaws)
   
   - CVSS Common vuln Scoring System ( for measuring and desc sev of seecurity related software flaws)
   
   - XCCDF Extensible Config Checklist Desc Format (language for specifying checklist and reporting checkist results)
   
   - OVAL Open Vuln and Assessment Language (language for specifying lowlevel testing proc used by checklists)
   
   **For more see NIST SP 800-117: guide ot using SCAP**
 </details>
 
 <details>
  <summary>Developing a Remediation Workflow</summary>
  <br>
   
   Org should come up with a remediation workflow and a way to keep track of it as scans can produce lots of results that may need attention from may different teams. This cycle should look like detection => remediation => testing. Should be as automated as possible. Some vuln tools have build in tracking for remediation, orgs sometimes dont like to use this and instead use ITSM (IT Service Managment) tool that organizes use for other issues. This keeps all issues under one tool. This does require the tool to be able to integrate with the ITSM (or vise versa) or find a way to integrate the info. 
    Trend in vuln mgmt is moving away from scheduled scanning for ongoing scanning. This scans as often as scanning resources allow. Bandwidth and resource intensive, but allows earlier detection of vulns. Cont monitoring incorporates data from agent based approaches to vuln detection and reports security-related config changes to the vuln mgmt platform as soon as they occur, analyzing those for potential vulns. 
   
   ### Reporting and Communication
   
   Reporting the discovered vuln to the correct leaders who handles that tech is important. Vuln mgmt tools can generate reports on demand or can have auto reports set up as well as an alerting system to notify admins when critical vulns are discovered. 
    Vuln mgmt tools can have differnt types of reports that different people may be interested in:
    
   Management level dashboards provide a high level summary of the cybersecurity health of the env. This type of report is often to give leaders a snapshot of the env. 
    An analyst would drill down deeper into the vuln mgmt tool. 
    System engineers usually want to know the info relating to the systems they specifically administer.
    Beyond that each vuln or config issue the tool detects will have its own dedicated page listing its details and suggested fix.
    
   ### Prioritizing Remediation
    
   Analysts must take several important factors into account when choosing where to turn their attention to first. Some of the most important factors include:
   
   - Criticality of the Systems and Info Afftected by the Vuln
     Take into account the CIA req depending on the nature of the vuln. If the vuln poses a DoS , consider the impact to the Org if systems become unusable.
   
   - Diff of Remediating the Vuln
      Factoring in how many people and resources it would take to fix the vuln.
   
   - Sev of Vuln
      May turn to CVSS to determine how sev the vuln is.
   
   - Exposure of Vuln
      i.e if the server has an SQL injection vuln , but is only acessable from an internal network, then its not as big of an issue then if it was internet facing.
     
     
   ### Testing and Implementing Fixes
     
   Before deploying any remediation activity, you must test the planned fix in a sandbox env. This allows to see unforeseen side effects of the fix and reduce probability that the remediation will disrupt business or cause damage to the org's assets.
   
   ## Overcoming Barriers to Vulnerability Scanning
   
   **Service degradation**: Most common barrier to vuln scanning. Scans eat bandwidth and tie up resources. May degrade systems. Can fix this by tuning scans. 
   
   **Customer Commitments**: Memorandums of Understanding (MOUs) and SLAs with customers may create expectations orelated to uptime, performance, and security. If scanning may impact any of these, customers may need to be involved with the decision making process.
   
   **IT Governance and Change Management Process** May need to work within org goverance process to otain support required to runa vuln mgmt program.
</details>

 ## Reviewing and interpreting Scan Reports</summary>
 
   Looked over to eliminate FPs , prioratize remediation, and delve into root causes of vulnerability reports. 
   Reports will give a rating to the vuln, a description, a solution, more info on it, Output of the returend host on how it found the vuln, and other hosts with the same report and its ports.
 

<details>
  <summary>Understanding CVSS</summary>
  <br>
 
 Insdustry standard for assessing the sev of security vulns. Provides a tech for scoring each vuln on a variety of measures.
 Provides good detailed info of the risk posed by a vuln. 
Sample of **CVSS vector**: CVSS2#AV:N/AC:M/Au:N/C:P/I:N/A:N
 
  First 3 evaluate the exploitability of the vuln, last 3 evaluate the impact of the vuln.
  
   ### Access Vector Metric
   Describes how an attacker would exploit the vuln: 
   
   - (L)ocal: Physical or logical access  -- Score: 0.395
   - (A)djacent Network: Access to local network that the affected system is on  -- Score: 0.646
   - (N)etwork: Can exploit over remote network  -- Score: 1
    
   ### Access Complexity Metric
   Describes the difficulty of exploiting the vuln
   
   - (H)igh: Req "Specialized" conditions -- Score: 0.350
   - (M)edium: Req "Somewhat special" conditions -- Score: 0.610
   - (L)ow: Does not req any specal conditions  -- Score: 0.710
   
   ### Authentication Metric
   Desc the auth hurdles that an attacer would need to clear to exploit a vuln
   
   - (M)ultiple: Auth 2 or more times -- Score: 0.450
   - (S)ingle: Auth once -- Score: 0.560
   - (N)one: Do not need to auth -- Score: 0.704
   
   ### Confidentiality Metric
   Desc the type of info disclosure that might occur
   
   - (N)one: No confidentaility impact -- Score: 0.000
   - (P)artial: Access to some info, but attacker does not have control over what info is comp -- Score: 0.275
   - (C)omplete: All info on system is comp -- Score: 0.660
   
   ### Integrity Metric
   Desc the type of info alteration that might occur
   
   - (N)one: No integrity impact -- Score: 0.000
   - (P)artial: Mod of some info, but attacker does not have control over what info is mod -- Score: 0.275
   - (C)omplete: All info on system is comp, attacker can change anything at will -- Score: 0.660
   
   ### Availability Metric
   Desc the type of disruption that can occur 
   
   - (N)one: No availability impact -- Score: 0.000
   - (P)artial: Degraded performance -- Score: 0.275
   - (C)omplete: System is completely shutdown-- Score: 0.660
   
   **Fourm of Incident Response and Security Team (FIRST) realeased CVSS V3 in June 2015 but not widely used, currently Verson 2 is used.**
   
   You can calc the **CVSS BASE SCORE**, a single number to represent the overall risk posed by the vuln. The base score is made up of the exploitability score, impact score and impact function.
   
   ## Calculating the CVSS base score
   
   Throughout this you will be plugging in the numbers gathered from each metric.
   
   ### Calculating the Exploitability Score
    
   Exploitability = 20 X AV X AC X Au
    
   ### Calculating the Impact Score
    
   Impact = 10.41 X (1 - (1 - C ) x (1 - I) X (1 - A)
    
   ### Determine the Impact Score
   
   If Impact Score is 0, the Impact function is 0. Otherwise the Impact Function value is 1.176.
   
   ### Calculate the Base Score
   
   Base Score = ((0.6 X Impact) + (0.4 X Exploitability) - 1.5) x ImpactFunction
   
   **You round up to the nearest point value**
    
   ## Categorizing the CVSS Base Score
   
   Under 4.0 - Low
   
   4.0 to <6.0 - Med
    
   6.0 to <10.0 - High
   
   10.0 - Critical
  </details>

Good practise to document exceptions to the vuln mgmt program, like discovered vulns that the org for whatever reason has decided not to remediate. 

Scans should never take place in a vacuum. You should turn to other sources of security info as you preform the analysis such as: 

- Logs
- SIEM that correlate log entries from multiple sources and provide actional int.
- Config Mgmt Systems that provide info on the OS and APPs installed.

This info is improtant when tring to compare a scan report with reality. 

You should watch the trends of discovered vulns, new number of vulns, age of existing vulns, and time req to remediate vulns. 
Nessus Security Centre has the ability to graph this data.

<details>
  <summary>Common Vulnerabilites</summary>
  <br>
 One of the most common alerts from a vuln scan is missing patches. 
 Mobile device can have a host of their own issues. Using MDM can inforce patches, manage configs, enfore encryptions, provide remote wipe functionality etc.
 DO not run EOL OS or Apps. 
 If you must have a system with an unsupported OS, you must have the appropriate compensating controls in place.
 
 ## Buffer Overflow
 
 When an attacker manipulates a program to place more data into an area of memory than is allocated to that program. The goal is to overwrite other info in mem with instructions that may be executed by a diff running proces. These are very common and tend to persist many years after discovery. 
An integer overflow is a variant of this where the result of an arithmic operation attempts to store an integer that is too large to fit in the specific buffer. Four of the top 10 breaches in 2015 were from 12-16 year old overflow vulns.

## Privilege Escalation 

Attackers seek to increase level of access to a target system. Exploit vuln to turn normal user to priv.
Dirty Cow - Announced OCT 2016, present in linux kernel for 9 years, ez to exploit. dirtycow.ninja was set up to spread word about details and corrective measures. 

## Arbitrary Code Execution

Allows attacker to run software of choice on system. Extra bad if able to with priv. 
Remote code execution is a subset that allow this over a network.

## Insecure Protocol Use

Use of older protocols (FTP, TELNET, etc). Upgrade to newer safer ones to fix (FTPS, SSH, etc).

## Debugging Modes

Debug modes typically give detailed info on the inner workings of an application and server & supported DBs. This info can also assist attackers seeking to gain info about system, auth type, etc. No need to support debug mode on proc systems, only on dev/test. 

## Network Vulnerabilities

Complex infra with network applicances that provide secure communication is also susceptible to security vulns.

### Missing Firmware Updates

Network devices also need to keep up with firmware updates.

### SSL and TLS Issues

Can be used to secure any type of network communications, most commonly used for web, HTTPS. SSL is NO LONGER SECURE, TLS has replaced this. Same function but does not contain the same security flaws. Same goes for early versions of TLS. Vluns scanners will report the use of these. The use of these outdated protocols can make users subject to evesdropping attacks. As of now TLS 1.2 and higher should be used. 

### Insecure Cipher Use

SSL & TLS protocols are typically desc as cryptographic algorithms, but are not. They just desc how crypto ciphers may be used to secure the communication, but are not crypto ciphers themselves. They allow admins to designate the ciphers that can be used with those protocols on a server by server basis. When a client and server wish to communicate using SSL/TLS, they exchange a list of ciphers that each system supports and agree on a mutually acceptable cipher.
Some ciphers contain vuln that render them insecure bc of there susceptibility to evesdropping attacks. Solving this requires altering the set of supported ciphers on the affected server.
More info: https://en.m.wikipedia.org/wiki/Cipher_suite

### Certificate Problems

SSL and TLS rely on the use of digital certs to validate the identiy of the servers and exchange crypto keys.These will display the browser warning: "Your connection is not private" then list the reasons detected. Vuln scans may detect issues with the certs presented by the server support SSL and/or TLS. Common errors include:

- **Mismatch between the Name on the Cert and the Name of the Server:** May indicate the use of a cert taken from another site. Digital equivilant of a fakeID "borrowed" ID. 

- **Expiration of the Digital Cert:** Certs have validity periods and expiration dates. And expired cert can mean the server admin failed to renew the cert in a timely manner. 

- **Unkown Cert Authority (CA):** Anyone can create a digital cert, they are only useful if the recipient of a cert trusts the entity that issued it. OS and browsers contain instructions to trust well-known CAs but will show an error if they encounter a cert issued by an unkown or untrusted CA. 

This can also be common for captive portals i.e you go to site but then are show the cert error page and is states the cert is issued the public wifi provider you are connected to. 

- **DNS:** Common source of vulns on enterprise networks. Such as buffer overflows, missing patches, and code execution. Others are more specific to DNS service. 

  - DNS amplification attack: Attacker sends crafted requests that elicit a much larger response then go to a spoofed address the server thinks the query came from. The spoofed address is actually the target of DoS attack and is bombarded by very large responses from DNS servers all over the world. 
  
- **Internal IP Disclosure:** Server not properly config may leak their private IP addr to remote systems. This can occur when the system includes its own IP addr in the header info returned to an http req. Its not ware that NAT is in use so it uses its own addr so it uses its own addr in th response. Attackers can use this to learn more about the internal config of a firewalled network. 

- **VPN issues:** Orgs use VPN to get into org network. Make sure is fully patched and not using insecure ciphers.

## Virtualization Vulnerabilites

- Hypervisor: Special OS that mediates access to underlying hardware resources. VMs then run on top of this. VMs may not be aware they are virtualized as the HV tricks them into thinking that hey have normal access to they underlying hardware, when its really being shared with other VMs. 

A HV running directly on top of harware is refered to as bare-metal virtualization. Commonly used in DCs. The other type is hosted, which is where there is an OS between the hardware and HV. 

- **VM Escape:** The most serious vulns related to virtualization. Especially when the the host runs systems of differing security levels. Attacker has access to a single vm and manages to leverage that access to intrude on the resources assigned to a differnt vm. HV are suppoest to prevent this by restricting a vms access to only resources assinged to it. Escap attaks all a process running on a vm to "escape" the HV restrictions.

- **Management Interface Access:** Mgmt interface overlooks and configs the virtualization env. Should be tightly controlled. Multi-factor auth. Never seen from public. Vuln scans will detect the presence of an accessible mgmt interface.

- **Virtual Host Patching:** Patch patch patch virtualization platforms.

- **Virtual Guest Issues:** VMs all individually get security attention as any other device. No difference from a security perspective if physical or virtual.

- **Virtual Network Issues:** Network connections between VMs may never touch a physical network and wont hit security controls, so proper virtual security controls must be used , such as virtual firewalls, network segmentation. Same attention as physical network. 

- **IoT:** supervisory control and data acquisition (SCADA) and industrial control systems (ICS) are some IoT systems you may come across. Systems that allow connection of physical devices and processes to networks and provide a lot of sources of data for Org to make their business proceses more efficient and effective. These can also be security concerns that get reported on vuln scans. Vuln to netowrk attacks. These often are more difficult to patch bc it is difficult to obtain patches. IoT manufactures dont have auto updates, you need to subscribe to bulletins to find patches.
 
 Mirai: 2016 - IoT botnet that a bombarded DYN (a global DNS provider) with req that took it down. Resulting is loss of DNS for a large chunk of the internet.
 

## Web Application Vulnerabilities

Vuln scanners typically have a limited ability to scan for web apps vulns. Many Orgs will supplements these with a dedicated web app vuln scanners. 

- **Injection Attacks:** Occur when an attacker is able to bypass normal security controlls and send commands through a web server, fooling the backend system into thinking the request came from the web server. Most common version of this is SQL injection. Two best ways to protect against SQL Inj are input validation and enforcement of least priv restrictions on DB access. Least priv would restrict the accessable tables by a web server. 

- **Cross Site Scripting:** An attacker embeds scripting commands on a website that will later be executed by another vistor acessing the site. Idea is to trick a user visiting the site into executing malicious code placed there by an untrusted third party. If discovered, you should work with dev to asses the validity of the result and implement the appropriate controls to prevent this type of attack, like input validation. 

  </details>





Template

<details>
  <summary></summary>
  <br>
  </details>
